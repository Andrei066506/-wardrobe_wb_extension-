# Wardrobe — Сервис подбора образов для Wildberries

Chrome-расширение и бэкенд для автоматического подбора образов одежды на основе выбранного товара на Wildberries.

## Описание

Сервис анализирует **якорный товар** (куртка, брюки, обувь, платье и т.д.) и рекомендует совместимые товары для создания полного образа. Система учитывает:

- **Пол**: мужской / женский / унисекс
- **Возраст**: взрослый / детский
- **Сезон**: зима / лето / весна / осень / всесезонный
- **Стиль**: casual / sport / office / streetwear / elegant
- **Категорию товара**: верх, низ, верхняя одежда, обувь, аксессуары, платье

В результате формируются **3 капсулы** (образа), в каждой — якорный товар + до 3 рекомендаций из дополняющих категорий.

## Структура проекта

```
Warderobe/
├── Backend/                 # Flask API
│   ├── app.py               # Основное приложение
│   ├── app_reserve_1.py     # Резервная версия 1
│   ├── app_reserve_2.py     # Резервная версия 2
│   ├── wb_client.py         # Клиент Wildberries Search API
│   ├── wb_image_loader.py   # Загрузка изображений с WB (basketstate)
│   ├── image_fetcher.py    # (при наличии)
│   ├── test_api.py         # Тест API (см. примечание ниже)
│   └── requirements.txt
├── ML/                      # Обогащение через LLM
│   ├── llm_enrich.py       # Атрибуты товара (категория, пол, стиль и т.д.)
│   ├── test_llm.py
│   └── llm_cache.json      # Кэш ответов LLM (создаётся автоматически)
├── wb_extention/            # Chrome-расширение
│   ├── manifest.json
│   ├── content.js          # Content script на страницах товара WB
│   ├── popup.html / popup.js
│   └── icon*.png
├── Frontend/                # Демо-страница (без расширения)
│   ├── index.html
│   └── style.css
├── .env                     # JWT_TOKEN для LLM (корень проекта)
└── .gitignore
```

Подробная техническая документация: [DOCUMENTATION.md](DOCUMENTATION.md).

## Установка и запуск

### 1. Backend (Flask API)

```bash
cd Backend
pip install -r requirements.txt
python app.py
```

Сервер: `http://localhost:5000`.

### 2. Chrome-расширение

1. Chrome → Расширения → **Режим разработчика** → **Загрузить распакованное расширение**
2. Укажите папку `wb_extention`
3. Откройте страницу товара на wildberries.ru (например `.../catalog/554742394/detail.aspx`) — появится кнопка **«Подобрать образ»**

### 3. ML (LLM) — опционально

Бэкенд работает и без LLM (эвристики по названию). Для обогащения через LLM:

1. В **корне проекта** создайте файл `.env`:
   ```env
   JWT_TOKEN=ваш_токен
   ```
2. Установите зависимости ML (в корне или в виртуальном окружении с Backend):
   ```bash
   pip install openai python-dotenv
   ```
3. LLM: **GLM-4.5-Air** (`https://corellm.wb.ru/glm-45-air/v1`). Результаты кэшируются в `ML/llm_cache.json`.

### 4. Демо-фронтенд (Frontend)

Откройте `Frontend/index.html` в браузере (или через локальный сервер). Поле ввода запроса и кнопка «Подобрать образ» вызывают `POST http://localhost:5000/api/capsule`. Backend должен быть запущен.

## Использование

1. Откройте страницу товара на Wildberries (`https://www.wildberries.ru/catalog/<nm_id>/detail.aspx`).
2. Нажмите **«Подобрать образ»** (рядом с названием товара или плавающая кнопка).
3. В боковой панели отобразятся 3 капсулы с рекомендациями и суммами.

Расширение передаёт на бэкенд: название товара, `nm_id`, а также подсказки с страницы WB (пол, возраст, сезон из хлебных крошек и характеристик).

## Особенности реализации

- **Определение пола**: приоритет — подсказки со страницы (hints) → LLM → эвристики по названию. Для мужского/женского якоря в рекомендациях требуются явные маркеры пола в названии.
- **Платья**: категория «платье» занимает верх и низ; рекомендуются только верхняя одежда и обувь.
- **Стиль office/elegant**: исключаются спортивные, тактические, камуфляжные, охотничьи товары.
- **Сезон и обувь**: сандалии/босоножки — только для женского летнего casual; зимой приоритет у тёплой обуви.
- **Кэширование**: ответы LLM кэшируются по `nm_id` в `ML/llm_cache.json`.

## API

- `GET /` — проверка работы сервера.
- `GET /api/image/<nm_id>` — изображение товара (прокси с WB).
- `POST /api/capsule` — создание капсул. Тело: `{ "query": "название", "nm_id": 123, "product_name": "...", "gender", "age_group", "season", "style" }`. Ответ: массив из 3 объектов `{ "outfit": [...], "anchor_style": "..." }`.

Подробнее: [DOCUMENTATION.md](DOCUMENTATION.md).

## Технологии

- **Backend**: Python 3.12+, Flask, flask-cors, requests, Pillow
- **Расширение**: Vanilla JS, Manifest V3
- **ML**: OpenAI-совместимый API (GLM-4.5-Air на corellm.wb.ru)
- **Данные**: Wildberries Search API, basketstate для изображений

## Резервные версии бэкенда

- `app_reserve_1.py` — базовая фильтрация по полу, сезону и категориям.
- `app_reserve_2.py` — улучшенное определение пола (LLM + эвристики).

## Примечание по тестам

`Backend/test_api.py` написан под старый формат ответа (плоский список товаров). Текущий API возвращает массив капсул `[{ "outfit": [...], "anchor_style": "..." }, ...]`. Для проверки можно использовать первый элемент первой капсулы: `data[0]["outfit"]`.

## Лицензия

Внутренний проект для демонстрации.
